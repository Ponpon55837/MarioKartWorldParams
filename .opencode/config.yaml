# OpenCode å°ˆæ¡ˆé…ç½®
# æ­¤é…ç½®ç¢ºä¿ AI åŠ©æ‰‹è‡ªå‹•éµå®ˆå°ˆæ¡ˆè¦ç¯„

# å…¨åŸŸè¡Œç‚ºè¦å‰‡
rules:
  # Git å·¥ä½œæµç¨‹è¦å‰‡
  git:
    # é—œéµè¦å‰‡ï¼šç¦æ­¢åœ¨ main åˆ†æ”¯ä¸Šç›´æ¥ä¿®æ”¹
    enforce_branch_workflow: true
    protected_branches:
      - main
      - master

    # ä»»ä½•æª”æ¡ˆä¿®æ”¹å‰éƒ½å¿…é ˆæª¢æŸ¥åˆ†æ”¯
    pre_modify_checks:
      - check_current_branch
      - ensure_feature_branch

    # åˆ†æ”¯å‘½åè¦ç¯„
    branch_naming:
      format: "<type>/<name>/<description>"
      types:
        - feat
        - fix
        - refactor
        - docs
        - style
        - test
        - chore
        - hotfix

    # Commit message è¦ç¯„
    commit_message:
      language: "zh-TW" # é è¨­ä½¿ç”¨ç¹é«”ä¸­æ–‡
      format: "<type>: <ä¸­æ–‡æè¿°>"

  # Claude æ†²æ³•è¦å‰‡
  constitution:
    # å››å¤§æ ¸å¿ƒåŸå‰‡ï¼ˆå„ªå…ˆé †åºï¼‰
    principles:
      - name: "å»£æ³›å®‰å…¨"
        priority: 1
        description: "ä¸ç ´å£äººé¡ç›£ç£ AI çš„é©ç•¶æ©Ÿåˆ¶"
        checks:
          - security_audit
          - sensitive_data_check
          - dependency_integrity

      - name: "å»£æ³›é“å¾·"
        priority: 2
        description: "èª å¯¦ã€ç§‰æŒè‰¯å¥½åƒ¹å€¼è§€ã€é¿å…ä¸ç•¶è¡Œç‚º"
        checks:
          - multilingual_support
          - accessibility_basic
          - data_transparency

      - name: "éµå¾ªå°ˆæ¡ˆæŒ‡å—"
        priority: 3
        description: "ç¬¦åˆå·²å»ºç«‹çš„æŠ€è¡“è¦ç¯„å’Œæœ€ä½³å¯¦è¸"
        checks:
          - git_branch_check
          - typescript_check
          - eslint_check

      - name: "çœŸæ­£æœ‰å¹«åŠ©"
        priority: 4
        description: "ç‚ºç”¨æˆ¶æä¾›å¯¦è³ªæ€§åƒ¹å€¼å’Œå„ªè³ªé«”é©—"
        checks:
          - build_success
          - readme_sync
          - performance_basic

    # è‡ªå‹•åŸ·è¡Œæ†²æ³•æª¢æŸ¥
    auto_check_script: ".opencode/hooks/constitution-check.sh"
    check_frequency: "pre_commit"

  # é–‹ç™¼æµç¨‹è¦å‰‡
  workflow:
    # ä¿®æ”¹æª”æ¡ˆå‰å¿…é ˆåŸ·è¡Œçš„æª¢æŸ¥
    before_file_modification:
      - name: "Claude æ†²æ³•æª¢æŸ¥"
        action: "åŸ·è¡Œ .opencode/hooks/constitution-check.sh"
        priority: "critical"
        auto_execute: true

      - name: "æª¢æŸ¥ Git åˆ†æ”¯"
        action: "ç¢ºèªä¸åœ¨ main/master åˆ†æ”¯ä¸Š"
        priority: "critical"
        auto_fix: true # è‡ªå‹•å»ºç«‹åŠŸèƒ½åˆ†æ”¯

      - name: "ç¢ºèªå°ˆæ¡ˆçµæ§‹"
        action: "æª¢æŸ¥æ˜¯å¦åœ¨æ­£ç¢ºçš„å°ˆæ¡ˆç›®éŒ„"
        priority: "high"

    # ä¿®æ”¹å¾Œå¿…é ˆåŸ·è¡Œçš„æ“ä½œ
    after_file_modification:
      - name: "Claude æ†²æ³•é‡æ–°æª¢æŸ¥"
        action: "åŸ·è¡Œå®Œæ•´çš„æ†²æ³•å“è³ªæª¢æŸ¥"
        priority: "critical"
        auto_execute: true

      - name: "æ¸¬è©¦è®Šæ›´"
        action: "åŸ·è¡Œ pnpm dev æ¸¬è©¦"
        priority: "critical"
        auto_execute: false # ä¸è‡ªå‹•åŸ·è¡Œï¼Œä½†æœƒæé†’

      - name: "æäº¤å‰ç¢ºèª"
        action: "ç­‰å¾…ä½¿ç”¨è€…ç¢ºèªå¾Œå†æ¨é€"
        priority: "critical"

  # Skills è‡ªå‹•è¼‰å…¥è¦å‰‡
  skills:
    # é€™äº› skills åœ¨æ¯æ¬¡å°è©±é–‹å§‹æ™‚éƒ½æœƒè‡ªå‹•è¼‰å…¥
    auto_load:
      - git-workflow
      - code-standards

    # æ ¹æ“šä»»å‹™é¡å‹è‡ªå‹•è§¸ç™¼çš„ skills
    triggers:
      - task_type: "file_modification"
        skills: ["git-workflow", "code-standards"]

      - task_type: "react_component"
        skills: ["react-best-practices", "code-standards"]

      - task_type: "ui_review"
        skills: ["web-design-guidelines", "code-standards"]

      - task_type: "translation"
        skills: ["i18n-workflow"]

# æé†’è¨Šæ¯è¨­å®š
reminders:
  # åœ¨ç‰¹å®šæ“ä½œå‰é¡¯ç¤ºçš„æé†’
  pre_action:
    file_edit: |
      âš ï¸ æª¢æŸ¥æ¸…å–®ï¼š
      1. ç¢ºèªç›®å‰ä¸åœ¨ main åˆ†æ”¯
      2. å·²å»ºç«‹é©ç•¶çš„åŠŸèƒ½åˆ†æ”¯
      3. åˆ†æ”¯å‘½åç¬¦åˆè¦ç¯„

    git_commit: |
      âš ï¸ æäº¤å‰ç¢ºèªï¼š
      1. ä½¿ç”¨ç¹é«”ä¸­æ–‡æ’°å¯« commit message
      2. éµå¾ª <type>: <æè¿°> æ ¼å¼
      3. å·²åœ¨æœ¬åœ°æ¸¬è©¦é

    git_push: |
      ğŸ›‘ æ¨é€å‰å¿…é ˆï¼š
      1. ç­‰å¾…ä½¿ç”¨è€…ç¢ºèª
      2. ç¢ºèªæ‰€æœ‰æ¸¬è©¦é€šé
      3. ä¸è¦è‡ªå‹•æ¨é€

# AI åŠ©æ‰‹è¡Œç‚ºè¨­å®š
assistant:
  # åœ¨åŸ·è¡Œä»»ä½•æª”æ¡ˆä¿®æ”¹å‰
  pre_flight_checks:
    enabled: true
    checks:
      - git_branch_check
      - project_structure_check

  # è‡ªå‹•ä¿®æ­£è¡Œç‚º
  auto_fix:
    enabled: true
    actions:
      - name: "è‡ªå‹•å»ºç«‹åŠŸèƒ½åˆ†æ”¯"
        condition: "åœ¨ main åˆ†æ”¯ä¸Šä¸”éœ€è¦ä¿®æ”¹æª”æ¡ˆ"
        action: "å»ºç«‹ç¬¦åˆè¦ç¯„çš„åŠŸèƒ½åˆ†æ”¯"

      - name: "è‡ªå‹•åˆ‡æ›åˆ†æ”¯"
        condition: "åœ¨éŒ¯èª¤çš„åˆ†æ”¯ä¸Š"
        action: "åˆ‡æ›åˆ°æ­£ç¢ºçš„åŠŸèƒ½åˆ†æ”¯"

  # äº’å‹•æ¨¡å¼
  interaction:
    # åœ¨é—œéµæ“ä½œå‰ç¸½æ˜¯è©¢å•ç¢ºèª
    require_confirmation:
      - git_push
      - git_merge
      - file_delete
      - destructive_operations

# å°ˆæ¡ˆç‰¹å®šè¨­å®š
project:
  name: "MarioKartWorldParams"
  type: "next.js"
  languages:
    - typescript
    - react

  # å°ˆæ¡ˆæ…£ä¾‹
  conventions:
    commit_language: "zh-TW"
    branch_format: "<type>/<name>/<description>"
    test_before_commit: true
    wait_for_user_approval: true
