# ğŸš€ Jotai å…¨åŸŸç‹€æ…‹ç®¡ç†å¯¦ç¾

## ğŸ“‹ æ¦‚è¿°

å°‡åŸæœ¬çš„ React æœ¬åœ°ç‹€æ…‹ç®¡ç†å‡ç´šç‚ºä½¿ç”¨ Jotai çš„å…¨åŸŸç‹€æ…‹ç®¡ç†ç³»çµ±ï¼Œæå‡æ‡‰ç”¨ç¨‹å¼æ€§èƒ½ä¸¦å¯¦ç¾ç”¨æˆ¶çµ„åˆçš„æœ¬åœ°æŒä¹…åŒ–ã€‚

## âœ¨ ä¸»è¦æ”¹é€²

### 1. ğŸ”§ å…¨åŸŸç‹€æ…‹ç®¡ç†
- **ä¹‹å‰**: æ¯å€‹é é¢åˆ‡æ›éƒ½æœƒé‡æ–°è¼‰å…¥ CSV è³‡æ–™
- **ç¾åœ¨**: è³‡æ–™è¼‰å…¥ä¸€æ¬¡å¾Œå­˜å„²åœ¨å…¨åŸŸç‹€æ…‹ä¸­ï¼Œé é¢åˆ‡æ›é›¶å»¶é²

### 2. ğŸ’¾ æŒä¹…åŒ–å„²å­˜
- **ä¹‹å‰**: ç”¨æˆ¶çµ„åˆåªå­˜åœ¨æ–¼è¨˜æ†¶é«”ï¼Œé‡æ–°æ•´ç†æœƒæ¶ˆå¤±
- **ç¾åœ¨**: ä½¿ç”¨ `atomWithStorage` è‡ªå‹•å°‡çµ„åˆå„²å­˜åˆ° localStorage

### 3. âš¡ æ€§èƒ½å„ªåŒ–
- **æ¸›å°‘é‡è¤‡è¼‰å…¥**: CSV æª”æ¡ˆåªè¼‰å…¥ä¸€æ¬¡
- **æ™ºèƒ½è¨ˆç®—**: ä½¿ç”¨ Jotai çš„ derived atoms é€²è¡Œä¾è³´è¿½è¹¤
- **è‡ªå‹•å„ªåŒ–**: Jotai è‡ªå‹•è™•ç† re-render å„ªåŒ–

## ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆ

### æ ¸å¿ƒæ–‡ä»¶çµæ§‹

```
src/
â”œâ”€â”€ store/
â”‚   â””â”€â”€ atoms.ts                    # Jotai atoms å®šç¾©
â”œâ”€â”€ providers/
â”‚   â””â”€â”€ JotaiProvider.tsx          # Provider çµ„ä»¶
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useMarioKartStore.ts       # è‡ªå®šç¾© hooks
â””â”€â”€ components/
    â””â”€â”€ TestPersistence.tsx        # æŒä¹…åŒ–æ¸¬è©¦å·¥å…·
```

### Atoms è¨­è¨ˆ

#### åŸºç¤è³‡æ–™ Atoms
- `charactersAtom` - è§’è‰²è³‡æ–™
- `vehiclesAtom` - è¼‰å…·è³‡æ–™
- `loadingAtom` - è¼‰å…¥ç‹€æ…‹
- `errorAtom` - éŒ¯èª¤ç‹€æ…‹

#### éæ¿¾ç‹€æ…‹ Atoms
- `sortByAtom` - æ’åºæ–¹å¼
- `speedFilterAtom` - é€Ÿåº¦éæ¿¾
- `handlingFilterAtom` - æ“æ§éæ¿¾
- `currentPageAtom` - ç•¶å‰é é¢

#### æŒä¹…åŒ– Atoms
- `combinationsAtom` - ç”¨æˆ¶çµ„åˆ (localStorage)

#### è¨ˆç®— Atoms
- `maxStatsAtom` - æœ€å¤§æ•¸å€¼è¨ˆç®—
- `sortedCharactersAtom` - æ’åºå¾Œçš„è§’è‰²
- `sortedVehiclesAtom` - æ’åºå¾Œçš„è¼‰å…·

#### æ“ä½œ Atoms
- `loadDataAtom` - è³‡æ–™è¼‰å…¥æ“ä½œ
- `addCombinationAtom` - æ–°å¢çµ„åˆæ“ä½œ
- `removeCombinationAtom` - ç§»é™¤çµ„åˆæ“ä½œ

## ğŸ” ä½¿ç”¨æ–¹å¼

### ä¸»è¦ Hook
```typescript
const {
  loading,
  error,
  characters,
  vehicles,
  maxStats,
  sortedCharacters,
  sortedVehicles,
  sortBy,
  setSortBy,
  speedFilter,
  setSpeedFilter,
  handlingFilter,
  setHandlingFilter,
  currentPage,
  setCurrentPage,
  combinations,
  addCombination,
  removeCombination,
  clearAllCombinations,
} = useMarioKartStore();
```

### å°ˆç”¨ Hooks
```typescript
// åªéœ€è¦åŸºæœ¬è³‡æ–™
const { loading, error, characters, vehicles } = useMarioKartData();

// åªéœ€è¦éæ¿¾åŠŸèƒ½
const { sortBy, setSortBy, speedFilter, setSpeedFilter } = useFilters();

// åªéœ€è¦çµ„åˆç®¡ç†
const { combinations, addCombination, removeCombination } = useCombinations();
```

## ğŸ’¾ æŒä¹…åŒ–æ©Ÿåˆ¶

### localStorage éµå€¼
- `mario-kart-combinations` - ç”¨æˆ¶çµ„åˆè³‡æ–™

### è³‡æ–™æ ¼å¼
```json
[
  {
    "id": "ç‘ªåˆ©æ­-æ¨™æº–è»Š-1642089600000",
    "character": { /* è§’è‰²è³‡æ–™ */ },
    "vehicle": { /* è¼‰å…·è³‡æ–™ */ },
    "combinedStats": { /* çµ„åˆçµ±è¨ˆ */ }
  }
]
```

### è‡ªå‹•å„²å­˜æ™‚æ©Ÿ
- æ–°å¢çµ„åˆæ™‚è‡ªå‹•å„²å­˜
- ç§»é™¤çµ„åˆæ™‚è‡ªå‹•å„²å­˜
- æ¸…é™¤æ‰€æœ‰çµ„åˆæ™‚è‡ªå‹•å„²å­˜

## ğŸ§ª æ¸¬è©¦åŠŸèƒ½

### æŒä¹…åŒ–æ¸¬è©¦å·¥å…·
ä½æ–¼ `/admin` é é¢ï¼Œæä¾›ï¼š
- æ¸¬è©¦çµ„åˆçš„å»ºç«‹
- localStorage ç‹€æ…‹æª¢æŸ¥
- æŒä¹…åŒ–åŠŸèƒ½é©—è­‰

### é–‹ç™¼å·¥å…·
- **Jotai DevTools**: é–‹ç™¼æ¨¡å¼ä¸‹è‡ªå‹•å•Ÿç”¨
- **ç‹€æ…‹æª¢è¦–**: å³æ™‚æŸ¥çœ‹ atoms ç‹€æ…‹è®ŠåŒ–
- **æ™‚é–“æ—…è¡Œ**: èª¿è©¦ç‹€æ…‹è®Šæ›´æ­·å²

## âš¡ æ€§èƒ½å°æ¯”

### ä¹‹å‰ (React æœ¬åœ°ç‹€æ…‹)
1. åˆ‡æ›åˆ°è§’è‰²é é¢ â†’ è¼‰å…¥ CSV (200ms)
2. åˆ‡æ›åˆ°è¼‰å…·é é¢ â†’ é‡æ–°è¼‰å…¥ CSV (200ms)
3. åˆ‡æ›åˆ°çµ„åˆé é¢ â†’ å†æ¬¡è¼‰å…¥ CSV (200ms)
4. é‡æ–°æ•´ç† â†’ ç”¨æˆ¶çµ„åˆæ¶ˆå¤±

### ç¾åœ¨ (Jotai å…¨åŸŸç‹€æ…‹)
1. åˆæ¬¡è¼‰å…¥ â†’ è¼‰å…¥ CSV (200ms)
2. åˆ‡æ›åˆ°ä»»ä½•é é¢ â†’ å³æ™‚åˆ‡æ› (0ms)
3. è³‡æ–™åœ¨è¨˜æ†¶é«”ä¸­å…±äº«
4. é‡æ–°æ•´ç† â†’ ç”¨æˆ¶çµ„åˆè‡ªå‹•æ¢å¾©

## ğŸ”® æœªä¾†æ“´å±•

### å¯èƒ½çš„æ”¹é€²
- [ ] æ·»åŠ é›¢ç·šæ”¯æ´
- [ ] å¯¦ç¾è³‡æ–™ç‰ˆæœ¬æ§åˆ¶
- [ ] æ·»åŠ ç”¨æˆ¶åå¥½è¨­å®šæŒä¹…åŒ–
- [ ] å¯¦ç¾è·¨è¨­å‚™åŒæ­¥ (Cloud Storage)
- [ ] æ·»åŠ æ•ˆèƒ½ç›£æ§å’Œåˆ†æ

### å…¶ä»– Atoms
- ç”¨æˆ¶åå¥½è¨­å®š (ä¸»é¡Œã€èªè¨€ç­‰)
- ç€è¦½æ­·å²
- æ”¶è—çš„è§’è‰²/è¼‰å…·
- è‡ªå®šç¾©æ’åºåå¥½

## ğŸ“Š æŠ€è¡“ç´°ç¯€

### ä¾è³´å¥—ä»¶
```json
{
  "jotai": "^2.12.5",
  "jotai-devtools": "^0.12.0"
}
```

### Bundle å¤§å°å½±éŸ¿
- Jotai: ~15KB (gzipped ~5KB)
- DevTools: åƒ…é–‹ç™¼æ¨¡å¼ä½¿ç”¨
- æ•´é«”å½±éŸ¿: å¾®å°ï¼Œæ€§èƒ½æå‡æ˜é¡¯

### ç€è¦½å™¨æ”¯æ´
- æ”¯æ´æ‰€æœ‰ç¾ä»£ç€è¦½å™¨
- localStorage API æ™®éæ”¯æ´
- ç„¡éœ€é¡å¤– polyfills

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **çµ„åˆæ²’æœ‰æŒä¹…åŒ–**
   - æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´ localStorage
   - ç¢ºèªæ²’æœ‰ç„¡ç—•æ¨¡å¼
   - æª¢æŸ¥æ§åˆ¶å°éŒ¯èª¤

2. **ç‹€æ…‹ä¸åŒæ­¥**
   - ç¢ºèª JotaiProvider æ­£ç¢ºåŒ…è£
   - æª¢æŸ¥æ˜¯å¦æœ‰å¤šå€‹ Provider å¯¦ä¾‹

3. **æ€§èƒ½å•é¡Œ**
   - ä½¿ç”¨ Jotai DevTools æª¢æŸ¥ atoms æ›´æ–°é »ç‡
   - ç¢ºèªæ²’æœ‰ä¸å¿…è¦çš„ atom è¨‚é–±

### èª¿è©¦æŠ€å·§
- ä½¿ç”¨ `console.log` åœ¨ atoms ä¸­èª¿è©¦
- åˆ©ç”¨ DevTools æŸ¥çœ‹ç‹€æ…‹è®ŠåŒ–
- æª¢æŸ¥ localStorage å…§å®¹
